extends layout-share

block headContent
	title Quote...

block content

	.mt-5.px-3(style="margin: auto; max-width: 1000px; width: 100%;")
		if (list)
			h5.mb-3
				a.badge.bg-primary(href=`/list/${list._id}`)
					i.bi-list.me-1
					| #{list.name}
				
				|  &raquo;
		
		- var quoteUrl = (list ? `/list/${list._id}/${quote._id}` : `/quote/${quote._id}`);


		- var date = quote.date;
		if (!date)
			- date = quote.createdAt;

		mixin quoteDate
			div
				| #{utils.formatDate(date, "MMM d, yyyy")}
				
				// TODO implement year pages
				if (false)
					a.text-reset.underlined-link(href=`/year/${utils.formatDate(date, "yyyy")}`) #{utils.formatDate(date, "yyyy")}
				
				if (utils.formatDate(date, "HH:mm:ss") != "00:00:00")
					| , #{utils.formatDate(date, "h:mma").toLowerCase()}

		mixin quoteLink
			if (quote.link)
				small.text-muted.ms-2 (
					if (quote.linkSite)
						a(href=quote.link, target="_blank") #{quote.linkSite}
					else
						a(href=quote.link, target="_blank") link

					|)


		.quote-body.lead
			if (quote.text)
				div
					.mb-4
						| !{marked(quote.text.replace(/\n/g, "\n\n"))}

					.ps-3
						footer.blockquote-footer
							i
								if (quote.speakers && quote.speakers.length > 0)
									each speaker, speakerIndex in quote.speakers
										if (quote.speakers.length > 2 && speakerIndex > 0)
											| , 
										
										if (quote.speakers.length > 1 && speakerIndex == (quote.speakers.length - 1))
											| & 
										
										if (noSpeakerLinks)
											span.speaker-non-link #{speaker}
										else
											a(href=`/speaker/${encodeURIComponent(speaker)}`) #{speaker ? speaker : "Unknown"}

										+quoteLink

										if (quote.speakerContexts && quote.speakerContexts.length > speakerIndex && quote.speakerContexts[speakerIndex].trim().length > 0)
											br
											small (#{quote.speakerContexts[speakerIndex]})
								else
									if (noSpeakerLinks)
										span.speaker-non-link Unknown
									else
										a(href=`/speaker/unknown`) Unknown

									+quoteLink
			
			else if (quote.parts)
				each part, partIndex in quote.parts
					div(class=(partIndex < (quote.parts.length - 1) ? "mb-3" : null))
						h6.mb-4
							a.text-reset.text-decoration-none(href=quoteUrl)
								| !{marked(part.replace(/\n/g, "\n\n"))}

						h6.ps-3
							footer.blockquote-footer.text-body
								i
									if (quote.speakers && quote.speakers.length > partIndex)
										if (noSpeakerLinks)
											span.speaker-non-link.text-dark #{quote.speakers[partIndex]}
										else
											a(href=`/speaker/${encodeURIComponent(quote.speakers[partIndex])}`) #{quote.speakers[partIndex] ? quote.speakers[partIndex] : "Unknown"}

										+quoteLink

										if (quote.speakerContexts && quote.speakerContexts.length > partIndex && quote.speakerContexts[partIndex].trim().length > 0)
											br
											small (#{quote.speakerContexts[partIndex]})
									else
										if (noSpeakerLinks)
											span.speaker-non-link.text-dark Unknown
										else
											a(href=`/speaker/unknown`) Unknown

										+quoteLink
		
		hr.mx-n3

		if (quote.username != session.username)
			.mb-2
				- var quoteUsername = quote.username;
				if (noUserLinks)
					span.badge.bg-info
						i.bi-person-circle.me-1
						| #{quoteUsername}

				else
					a.badge.bg-info(href=`/${quoteUsername}/quotes`)
						i.bi-person-circle.me-1
						| #{quoteUsername}


		if (date)
			+quoteDate
				
